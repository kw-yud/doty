# OpenVPN Server NAT
# 
# The Book of PF, p. 21
# Allow VPN connections to the VPN host:
# http://serverfault.com/questions/555594/troubleshoot-broken-tcp-from-openvpn-client-to-server-but-ping-traceroute-work
# $ sudo vi /etc/sysctl.conf
# net.inet.ip.forwarding=1
# net.inet6.ip6.forwarding=1

# Internal interface; use the command `ifconfig -a` or:
# $ ifconfig | pcregrep -M -o '^[^\t:]+:([^\n]|\n\t)*status: active' | egrep -o -m 1 '^[^\t:]+'
int_iface = "en0"

# VPN network
# $vpn_net == utun4/24 when Tunnelblick creates utun4
vpn_net = "10.18.0/24"	# utun4 interface doesn't exist at boot time

# Use a list in case Tunnelblick creates multiples utun interaces
tun_iface = "{ utun0, utun1, utun2, utun3, utun4 }"
not_tun_iface = "{ !utun0, !utun1, !utun2, !utun3, !utun4 }"

no nat on $not_tun_iface inet from $vpn_net to ($int_iface)
nat on $not_tun_iface inet from $vpn_net to ! ($int_iface) -> ($int_iface)

# This rule must be included below BEFORE these packets are passed by other rules:
# pass in quick on $tun_if reply-to $tun_if inet from $vpn_net to $int_if

